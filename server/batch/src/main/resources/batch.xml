<?xml version="1.0" encoding="UTF-8"?>
<beans:beans xmlns="http://www.springframework.org/schema/batch" xmlns:beans="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd http://www.springframework.org/schema/batch http://www.springframework.org/schema/batch/spring-batch-2.1.xsd">

    <beans:import resource="database.xml" />

    <beans:import resource="dao.xml" />

    <beans:import resource="SBF01.xml" />

    <beans:import resource="SBF02.xml" />

    <beans:import resource="SBF07.xml" />

    <beans:import resource="SBT27.xml" />

    <job-repository />

    <beans:bean id="jobLauncher" class="org.springframework.batch.core.launch.support.SimpleJobLauncher">
        <beans:property name="jobRepository" ref="jobRepository"></beans:property>
    </beans:bean>

    <beans:bean id="itemSqlParameterSourceProvider" class="org.springframework.batch.item.database.BeanPropertyItemSqlParameterSourceProvider"></beans:bean>

    <beans:bean id="skipDecider" class="tw.com.citi.cdic.batch.job.flow.SkipDecider" abstract="true"></beans:bean>

    <beans:bean id="checkFilesDecider" parent="skipDecider">
        <beans:property name="stepName" value="checkFiles"></beans:property>
    </beans:bean>

    <beans:bean id="copyFilesDecider" parent="skipDecider">
        <beans:property name="stepName" value="copyFiles"></beans:property>
    </beans:bean>

    <beans:bean id="f01Decider" parent="skipDecider">
        <beans:property name="stepName" value="f01"></beans:property>
    </beans:bean>

    <beans:bean id="f02Decider" parent="skipDecider">
        <beans:property name="stepName" value="f02"></beans:property>
    </beans:bean>

    <beans:bean id="f07Decider" parent="skipDecider">
        <beans:property name="stepName" value="f07"></beans:property>
    </beans:bean>

    <beans:bean id="t01Decider" parent="skipDecider">
        <beans:property name="stepName" value="t01"></beans:property>
    </beans:bean>

    <beans:bean id="t04Decider" parent="skipDecider">
        <beans:property name="stepName" value="t04"></beans:property>
    </beans:bean>

    <beans:bean id="t08Decider" parent="skipDecider">
        <beans:property name="stepName" value="t08"></beans:property>
    </beans:bean>

    <beans:bean id="t09Decider" parent="skipDecider">
        <beans:property name="stepName" value="t09"></beans:property>
    </beans:bean>

    <beans:bean id="t10Decider" parent="skipDecider">
        <beans:property name="stepName" value="t10"></beans:property>
    </beans:bean>

    <beans:bean id="t11Decider" parent="skipDecider">
        <beans:property name="stepName" value="t11"></beans:property>
    </beans:bean>

    <beans:bean id="t13Decider" parent="skipDecider">
        <beans:property name="stepName" value="t13"></beans:property>
    </beans:bean>

    <beans:bean id="t14Decider" parent="skipDecider">
        <beans:property name="stepName" value="t14"></beans:property>
    </beans:bean>

    <beans:bean id="t18Decider" parent="skipDecider">
        <beans:property name="stepName" value="t18"></beans:property>
    </beans:bean>

    <beans:bean id="t19Decider" parent="skipDecider">
        <beans:property name="stepName" value="t19"></beans:property>
    </beans:bean>

    <beans:bean id="t20Decider" parent="skipDecider">
        <beans:property name="stepName" value="t20"></beans:property>
    </beans:bean>

    <beans:bean id="t21Decider" parent="skipDecider">
        <beans:property name="stepName" value="t21"></beans:property>
    </beans:bean>

    <beans:bean id="t27Decider" parent="skipDecider">
        <beans:property name="stepName" value="t27"></beans:property>
    </beans:bean>

    <job id="convertJob">

        <decision id="checkFilesDecision" decider="checkFilesDecider">
            <next on="EXECUTE" to="checkFiles" />
            <next on="SKIP" to="copyFilesDecision" />
        </decision>
        <step id="checkFiles">
            <description>檢查檔案是否已經準備好</description>
            <tasklet>
                <beans:bean class="tw.com.citi.cdic.batch.step.tasklet.CheckFilesTasklet" />
            </tasklet>
            <fail on="FAILED" exit-code="FILE INCOMPLETE" />
            <next on="*" to="copyFilesDecision" />
        </step>

        <decision id="copyFilesDecision" decider="copyFilesDecider">
            <next on="EXECUTE" to="copyFiles" />
            <next on="SKIP" to="importFiles" />
        </decision>
        <step id="copyFiles" next="importFiles">
            <description>將檔案複製一份至 process 資料夾</description>
            <tasklet>
                <beans:bean class="tw.com.citi.cdic.batch.step.tasklet.CopyFilesTasklet">
                    <beans:property name="sourceDir" value="z:/input"></beans:property>
                    <beans:property name="targetDir" value="z:/process"></beans:property>
                </beans:bean>
            </tasklet>
        </step>

        <split id="importFiles">
            <flow>
                <decision id="f01Decision" decider="f01Decider">
                    <next on="EXECUTE" to="f01" />
                    <end on="SKIP" />
                </decision>
                <step id="f01">
                    <description>把 bus view 的資料 import 至 A11 file</description>
                    <tasklet>
                        <chunk reader="busDbReader" writer="a11FileWriter" commit-interval="500"></chunk>
                    </tasklet>
                </step>
            </flow>
            <flow>
                <decision id="f02Decision" decider="f02Decider">
                    <next on="EXECUTE" to="f02-a21" />
                    <end on="SKIP" />
                </decision>
                <step id="f02-a21" next="f02-b21">
                    <description>把 CDICF02I 的資料 import 至 A21 file</description>
                    <tasklet>
                        <chunk reader="cdicF02IFileReader" writer="a21FileWriter" commit-interval="500"></chunk>
                    </tasklet>
                </step>
                <step id="f02-b21" next="f02-c21">
                    <description>把 CDICF02R 的資料 import 至 B21, C21 files</description>
                    <tasklet>
                        <chunk reader="cdicF02RFileReader" processor="b21Processor" writer="b21FileWriter" commit-interval="500"></chunk>
                    </tasklet>
                </step>
                <step id="f02-c21">
                    <description></description>
                    <tasklet>
                        <chunk reader="cdicF02RFileReader" processor="c21Processor" writer="c21FileWriter" commit-interval="500"></chunk>
                    </tasklet>
                </step>
            </flow>
            <flow>
                <decision id="f07Decision" decider="f07Decider">
                    <next on="EXECUTE" to="f07-a26" />
                    <end on="SKIP" />
                </decision>
                <step id="f07-a26" next="f07-b26">
                    <description>把 CDICF07H 的資料 import 至 A26 file</description>
                    <tasklet>
                        <chunk reader="cdicF07HFileReader" processor="a26Processor" writer="a26FileWriter" commit-interval="500"></chunk>
                    </tasklet>
                </step>
                <step id="f07-b26" next="f07-c26">
                    <description>把 CDICF07H 的資料 import 至 B26 file</description>
                    <tasklet>
                        <chunk reader="cdicF07HFileReader" processor="b26Processor" writer="b26FileWriter" commit-interval="500"></chunk>
                    </tasklet>
                </step>
                <step id="f07-c26">
                    <description>把 CDICF07H 的資料 import 至 C26 file</description>
                    <tasklet>
                        <chunk reader="cdicF07HFileReader" processor="c26Processor" writer="c26FileWriter" commit-interval="500"></chunk>
                    </tasklet>
                </step>
            </flow>
            <flow>
                <decision id="t01Decision" decider="t01Decider">
                    <next on="EXECUTE" to="t01" />
                    <end on="SKIP" />
                </decision>
                <step id="t01">
                    <description>把 local file CDICT04 的資料複製至 T04 file</description>
                    <tasklet>
                        <beans:bean class="tw.com.citi.cdic.batch.step.tasklet.CopyFilesTasklet">
                            <beans:property name="sourceDir" value="z:/input/CDICT01.txt"></beans:property>
                            <beans:property name="targetDir" value="z:/process/T01.txt"></beans:property>
                        </beans:bean>
                    </tasklet>
                </step>
            </flow>
            <flow>
                <decision id="t04Decision" decider="t04Decider">
                    <next on="EXECUTE" to="t04" />
                    <end on="SKIP" />
                </decision>
                <step id="t04">
                    <description>把 local file CDICT04 的資料複製至 T04 file</description>
                    <tasklet>
                        <beans:bean class="tw.com.citi.cdic.batch.step.tasklet.CopyFilesTasklet">
                            <beans:property name="sourceDir" value="z:/input/CDICT04.txt"></beans:property>
                            <beans:property name="targetDir" value="z:/process/T04.txt"></beans:property>
                        </beans:bean>
                    </tasklet>
                </step>
            </flow>
            <flow>
                <decision id="t08Decision" decider="t08Decider">
                    <next on="EXECUTE" to="t08" />
                    <end on="SKIP" />
                </decision>
                <step id="t08">
                    <description>把 local file CDICT08 的資料複製至 T08 file</description>
                    <tasklet>
                        <beans:bean class="tw.com.citi.cdic.batch.step.tasklet.CopyFilesTasklet">
                            <beans:property name="sourceDir" value="z:/input/CDICT08.txt"></beans:property>
                            <beans:property name="targetDir" value="z:/process/T08.txt"></beans:property>
                        </beans:bean>
                    </tasklet>
                </step>
            </flow>
            <flow>
                <decision id="t09Decision" decider="t09Decider">
                    <next on="EXECUTE" to="t09" />
                    <end on="SKIP" />
                </decision>
                <step id="t09">
                    <description>把 local file CDICT09 的資料複製至 T09 file</description>
                    <tasklet>
                        <beans:bean class="tw.com.citi.cdic.batch.step.tasklet.CopyFilesTasklet">
                            <beans:property name="sourceDir" value="z:/input/CDICT09.txt"></beans:property>
                            <beans:property name="targetDir" value="z:/process/T09.txt"></beans:property>
                        </beans:bean>
                    </tasklet>
                </step>
            </flow>
            <flow>
                <decision id="t10Decision" decider="t10Decider">
                    <next on="EXECUTE" to="t10" />
                    <end on="SKIP" />
                </decision>
                <step id="t10">
                    <description>把 local file CDICT10 的資料複製至 T10 file</description>
                    <tasklet>
                        <beans:bean class="tw.com.citi.cdic.batch.step.tasklet.CopyFilesTasklet">
                            <beans:property name="sourceDir" value="z:/input/CDICT10.txt"></beans:property>
                            <beans:property name="targetDir" value="z:/process/T10.txt"></beans:property>
                        </beans:bean>
                    </tasklet>
                </step>
            </flow>
            <flow>
                <decision id="t11Decision" decider="t11Decider">
                    <next on="EXECUTE" to="t11" />
                    <end on="SKIP" />
                </decision>
                <step id="t11">
                    <description>把 host file CDICT11 的資料複製至 T11 file</description>
                    <tasklet>
                        <beans:bean class="tw.com.citi.cdic.batch.step.tasklet.CopyFilesTasklet">
                            <beans:property name="sourceDir" value="z:/input/CDICT11.txt"></beans:property>
                            <beans:property name="targetDir" value="z:/process/T11.txt"></beans:property>
                        </beans:bean>
                    </tasklet>
                </step>
            </flow>
            <flow>
                <decision id="t13Decision" decider="t13Decider">
                    <next on="EXECUTE" to="t13" />
                    <end on="SKIP" />
                </decision>
                <step id="t13">
                    <description>把 local file CDICT13 的資料複製至 T13 file</description>
                    <tasklet>
                        <beans:bean class="tw.com.citi.cdic.batch.step.tasklet.CopyFilesTasklet">
                            <beans:property name="sourceDir" value="z:/input/CDICT13.txt"></beans:property>
                            <beans:property name="targetDir" value="z:/process/T13.txt"></beans:property>
                        </beans:bean>
                    </tasklet>
                </step>
            </flow>
            <flow>
                <decision id="t14Decision" decider="t14Decider">
                    <next on="EXECUTE" to="t14" />
                    <end on="SKIP" />
                </decision>
                <step id="t14">
                    <description>把 local file CDICT14 的資料複製至 T14 file</description>
                    <tasklet>
                        <beans:bean class="tw.com.citi.cdic.batch.step.tasklet.CopyFilesTasklet">
                            <beans:property name="sourceDir" value="z:/input/CDICT14.txt"></beans:property>
                            <beans:property name="targetDir" value="z:/process/T14.txt"></beans:property>
                        </beans:bean>
                    </tasklet>
                </step>
            </flow>
            <flow>
                <decision id="t18Decision" decider="t18Decider">
                    <next on="EXECUTE" to="t18" />
                    <end on="SKIP" />
                </decision>
                <step id="t18">
                    <description>把 local file CDICT18 的資料複製至 T18 file</description>
                    <tasklet>
                        <beans:bean class="tw.com.citi.cdic.batch.step.tasklet.CopyFilesTasklet">
                            <beans:property name="sourceDir" value="z:/input/CDICT18.txt"></beans:property>
                            <beans:property name="targetDir" value="z:/process/T18.txt"></beans:property>
                        </beans:bean>
                    </tasklet>
                </step>
            </flow>
            <flow>
                <decision id="t19Decision" decider="t19Decider">
                    <next on="EXECUTE" to="t19" />
                    <end on="SKIP" />
                </decision>
                <step id="t19">
                    <description>把 local file CDICT19 的資料複製至 T19 file</description>
                    <tasklet>
                        <beans:bean class="tw.com.citi.cdic.batch.step.tasklet.CopyFilesTasklet">
                            <beans:property name="sourceDir" value="z:/input/CDICT19.txt"></beans:property>
                            <beans:property name="targetDir" value="z:/process/T19.txt"></beans:property>
                        </beans:bean>
                    </tasklet>
                </step>
            </flow>
            <flow>
                <decision id="t20Decision" decider="t20Decider">
                    <next on="EXECUTE" to="t20" />
                    <end on="SKIP" />
                </decision>
                <step id="t20">
                    <description>把 local file CDICT20 的資料複製至 T20 file</description>
                    <tasklet>
                        <beans:bean class="tw.com.citi.cdic.batch.step.tasklet.CopyFilesTasklet">
                            <beans:property name="sourceDir" value="z:/input/CDICT20.txt"></beans:property>
                            <beans:property name="targetDir" value="z:/process/T20.txt"></beans:property>
                        </beans:bean>
                    </tasklet>
                </step>
            </flow>
            <flow>
                <decision id="t21Decision" decider="t21Decider">
                    <next on="EXECUTE" to="t21" />
                    <end on="SKIP" />
                </decision>
                <step id="t21">
                    <description>把 local file CDICT21 的資料複製至 T21 file</description>
                    <tasklet>
                        <beans:bean class="tw.com.citi.cdic.batch.step.tasklet.CopyFilesTasklet">
                            <beans:property name="sourceDir" value="z:/input/CDICT21.txt"></beans:property>
                            <beans:property name="targetDir" value="z:/process/T21.txt"></beans:property>
                        </beans:bean>
                    </tasklet>
                </step>
            </flow>
            <flow>
                <decision id="t27Decision" decider="t27Decider">
                    <next on="EXECUTE" to="t27" />
                    <end on="SKIP" />
                </decision>
                <step id="t27">
                    <description>把 CDICT27H 的資料 import 至 T27 file</description>
                    <tasklet>
                        <chunk reader="cdicT27HFileReader" processor="t27Processor" writer="t27FileWriter" commit-interval="500"></chunk>
                    </tasklet>
                </step>
            </flow>
        </split>

    </job>

</beans:beans>
